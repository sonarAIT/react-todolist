import React, { useEffect } from "react";
import type { NextPage } from "next";
import Head from "next/head";
import axios from "axios";
import useSWR from "swr";
import { useSetRecoilState } from "recoil";

import type { Todo } from "@prisma/client";

import { todoAtom } from "./atom/todoAtom";
import TodoInput from "./TodoInput";
import TodoList from "./TodoList";

const _Home: NextPage = () => {
    console.log("Home");
    const setTodoList = useSetRecoilState<Array<Todo>>(todoAtom);
    const { data: data, error } = useSWR<Array<Todo>>(
        "/api/todo",
        (url: string): Promise<Array<Todo>> =>
            axios(url, {
                headers: { "Content-Type": "application/json" },
            }).then((res) => res.data)
    );

    useEffect(() => {
        if (data && !error) {
            setTodoList(data);
        }
    }, [data, error]);

    return (
        <div>
            <Head>
                <title>Create Next App</title>
                <meta
                    name="description"
                    content="Generated by create next app"
                />
                <link rel="icon" href="/favicon.ico" />
            </Head>

            <TodoInput />
            <TodoList />
        </div>
    );
};

const Home = React.memo(_Home);
export default Home;
