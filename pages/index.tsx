import React, { useEffect } from "react";
import type { NextPage } from "next";
import Head from "next/head";
import axios from "axios";
import useSWR from "swr";
import { useSetRecoilState } from "recoil";

import { Todo, todoAtom } from "./atom/todoAtom";
import TodoInput from "./TodoInput";
import TodoList from "./TodoList";
import ErrorMessage from "./errorMessage";

export const MOCK_TODOS_URL = "http://localhost:3001/todos/";

const _Home: NextPage = () => {
    console.log("Home");
    const setTodoList = useSetRecoilState<Array<Todo>>(todoAtom);
    const { data: data, error } = useSWR<Array<Todo>>(
        MOCK_TODOS_URL,
        (url: string): Promise<Array<Todo>> =>
            axios(url).then((res) => res.data)
    );

    useEffect(() => {
        if (data && !error) {
            setTodoList(data);
        }
    }, [data, error]);

    return (
        <div>
            <Head>
                <title>Create Next App</title>
                <meta
                    name="description"
                    content="Generated by create next app"
                />
                <link rel="icon" href="/favicon.ico" />
            </Head>
            
            <TodoInput />
            <ErrorMessage data={data} error={error} />
            <TodoList />
        </div>
    );
};

const Home = React.memo(_Home);
export default Home;
